{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">ElementeCart Bestellformular</h1>

    <!-- Message info -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}" role="alert">
            <button class="close" data-dismiss="alert"><small>x</small></button>
            {{ message }}
        </div>
        {% endfor %}
    {% endif %}
    <!-- Message info end -->

    <!-- Kunden-Nr. Section -->
    <form method="POST">
        {% csrf_token %}
        {% if not kunden_nr %}
        <div class="form-group">
            <label for="kunden-nr">Kunden-Nr.</label>
            {{ kunden_nr_form.kunden_nr }}
        </div>
        <button type="submit" name="set_kunden_nr" class="btn btn-primary">Kunden-Nr. Festlegen</button>
        {% else %}
        <p><strong>Kunden-Nr.:</strong> {{ kunden_nr }}</p>
        {% if kunde_details %}
        <p><strong>Kunde:</strong> 
            {% if kunde_details.firmenname %}
                {{ kunde_details.firmenname }}
            {% endif %}
            {% if kunde_details.vorname and kunde_details.nachname %}
                {{ kunde_details.vorname }} {{ kunde_details.nachname }}
            {% endif %}
        </p>
        {% endif %}
        {% endif %}
    </form>

    <hr>

    <!-- Add Item to Cart Section -->
    {% if kunde_details %}
    <form method="POST">
        {% csrf_token %}
        <div class="form-group">
            <label for="element-nr">Element-Nr.</label>
            {{ form.element_nr }}
        </div>
        <div class="form-group">
            <label for="anzahl">Anzahl</label>
            {{ form.anzahl }}
        </div>
        <button type="submit" name="add_to_cart" class="btn btn-primary">Hinzufügen</button>
    </form>
    {% endif %}

    <hr>

    <!-- Cart Table -->
    <h2 class="mt-4">Warenkorb</h2>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Element-Nr.</th>
                <th>Anzahl</th>
                <th>Kühlposition</th>
                <th>Bezeichnung</th>
                <th>Aktion</th>
            </tr>
        </thead>
        <tbody>
            {% if cart_items_with_details %}
                {% for item in cart_items_with_details %}
                <tr>
                    <td>{{ item.element_nr }}</td>
                    <td>{{ item.anzahl }}</td>
                    <td>{{ item.kuehlposition }}</td>
                    <td>{{ item.bezeichnung }}</td>
                    <td>
                        <form method="POST">
                            {% csrf_token %}
                            <input type="hidden" name="delete_item_id" value="{{ item.id }}">
                            <button type="submit" name="delete_item" class="btn btn-danger btn-sm">Löschen</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="5" class="text-center">Der Warenkorb ist leer.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>

    <form method="POST">
        {% csrf_token %}
        <button type="submit" name="checkout" class="btn btn-success" {% if not cart_items_with_details %} disabled {% endif %}>
            Zur Kasse
        </button>
    </form>
</div>
{% endblock %}
